# Python Development Context for `unicefData`

This file provides Python-specific guidance for AI coding agents working within the `python/` directory.

## Python Environment Setup

- **Current installation on this machine:**
  - **Path:** `C:\Users\jpazevedo\AppData\Local\Programs\Python\Python311\python.exe`
  - **Version:** Python 3.11.5
  - **Virtual environment:** `C:\GitHub\.venv`
- Ensure the required Python packages are installed from `python/requirements.txt`.
- Use a virtual environment (recommended: `C:\GitHub\.venv` or `<repo>\.venv`).
- **Activate virtual environment:**
  ```powershell
  & C:\GitHub\.venv\Scripts\Activate.ps1
  ```
- Install dependencies:
  ```bash
  pip install -r python/requirements.txt
  ```

## Running Python Tests

If Python scripts include tests, use `pytest`:
```bash
pytest
```

## Python Metadata Scripts

| Script | Function | Output Files |
|--------|----------|--------------|
| `run_sync.py` | **Main entry point** - orchestrates all sync operations | Calls other modules |
| `schema_sync.py` | Fetches dataflow DSDs, samples data for dimension values | `dataflows/*.yaml` |
| `indicator_registry.py` | Fetches `CL_UNICEF_INDICATOR` codelist, caches with 30-day staleness | `unicef_indicators_metadata.yaml` |

**Key functions:**
```python
# schema_sync.py
sync_dataflow_schemas()  # Main sync function

# indicator_registry.py
refresh_indicator_cache()  # Force refresh from API
get_dataflow_for_indicator(code)  # Lookup with override table
get_cache_info()  # Check cache status
```

## Python Metadata Directory Structure

```
python/
├── metadata/current/           # Python-generated metadata
│   ├── _unicefdata_*.yaml      # Core metadata (5 files)
│   ├── unicef_indicators_metadata.yaml  # Full indicator codelist
│   └── dataflows/*.yaml        # Individual dataflow schemas
└── unicef_api/
    ├── run_sync.py             # Main entry point
    ├── schema_sync.py          # Dataflow schema sync
    └── indicator_registry.py   # Indicator codelist sync
```

## Cross-Platform Consistency

When updating function parameters in Python, ensure alignment across all platforms:
- Python: `python/unicef_api/core.py` (update function + docstrings)
- R: `R/unicefData.R` (update function + roxygen comments, then `devtools::document()`)
- Stata: `stata/src/u/unicefdata.ado` (update syntax + help file)
