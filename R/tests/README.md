# R Test Suite

This directory contains the test suite for the R implementation of the `unicefData` library. These tests ensure the reliability of API interactions, data parsing, and metadata management.

## Test Scripts

### 1. `run_tests.R`
**Description**: The main comprehensive test suite. It validates all major functionality including:
- Listing dataflows
- Fetching data for specific domains (Mortality, Stunting, Immunization)
- Handling multiple indicators
- Metadata synchronization

**Usage**:
```r
source("R/tests/run_tests.R")
run_all_tests()
```

**Expected Output**:
- Console logs indicating progress.
- CSV files generated in `output/`:
  - `test_dataflows.csv`
  - `test_mortality.csv`
  - `test_stunting.csv`
  - `test_immunization.csv`
  - `test_multiple_indicators.csv`
- Metadata cache generated in `output/metadata_sync_test/`.

---

### 2. `test_prod_sdg_indicators.R`
**Description**: A production-readiness test that replicates the indicator downloads required for the SDG Report 2025. It mirrors the corresponding Python test to ensure parity between the two implementations.

**Usage**:
```r
source("R/tests/test_prod_sdg_indicators.R")
```

**Expected Output**:
- Detailed console output for each category (MORTALITY, NUTRITION, EDUCATION, etc.).
- A final summary table of passed/failed categories and total rows fetched.

---

### 3. `test_git_unicef.R`
**Description**: A low-level test script that fetches raw data for a wide range of specific flows (HIV, WASH, MNCH, Child Protection, etc.) to ensure API connectivity and correct parsing for various data structures.

**Usage**:
```r
source("R/tests/test_git_unicef.R")
```

**Expected Output**:
- Raw CSV files saved to `output/raw_api_data/`:
  - `api_unf_mort.csv`
  - `api_unf_edu.csv`
  - `api_unf_hiv.csv`
  - etc.
- A log file `test_get_unicef.log` created in the working directory.

---

### 4. `test_fallback.R`
**Description**: Specifically tests the logic that handles dataflow resolution. It verifies that the system correctly identifies when to use specific dataflows (e.g., `CME`) versus falling back to the global dataflow.

**Usage**:
```r
source("R/tests/test_fallback.R")
```

**Expected Output**:
- Console summary of the fallback logic tests, confirming if the correct dataflow was selected for each indicator.

## Output Directory (`output/`)

All test artifacts are saved in the `output/` directory to avoid cluttering the repository. This directory is ignored by git.

- **`raw_api_data/`**: Contains raw CSV downloads from `test_git_unicef.R`.
- **`metadata_sync_test/`**: Contains the cache generated by metadata sync tests.
- **`*.csv`**: Various output files from `run_tests.R`.
