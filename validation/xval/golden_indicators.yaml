# =============================================================================
# Golden Indicators for Cross-Platform Validation (xval)
# =============================================================================
#
# This file defines a curated set of indicators that are:
# 1. Verified to return data on ALL platforms (Python, R, Stata)
# 2. Representative of key UNICEF dataflows
# 3. Stable over time (not deprecated or frequently renamed)
#
# These indicators form the "golden set" used for regression testing.
# Tests against this set should ALWAYS pass. Any failure indicates a real bug.
#
# Last verified: 2026-01-31
# =============================================================================

metadata:
  version: "1.0"
  last_updated: "2026-01-31"
  description: "Hand-verified indicators for deterministic cross-platform testing"

# =============================================================================
# Platform Syntax Reference
# =============================================================================
# Actual commands used to retrieve data in each language.
# Use these examples to debug cross-platform differences.
#
# -----------------------------------------------------------------------------
# PYTHON
# -----------------------------------------------------------------------------
# Basic usage:
#   from unicef_api import get_indicator
#   df = get_indicator("CME_MRY0T4")
#
# With filters:
#   df = get_indicator("CME_MRY0T4",
#                      countries=["BRA", "IND", "NGA"],
#                      year=(2015, 2023))
#
# Wide format:
#   df = get_indicator("CME_MRM0",
#                      year=(2015, 2023),
#                      format="wide")
#
# Raw (no disaggregation filtering):
#   df = get_indicator("NT_CF_MAD", raw=True)
#
# -----------------------------------------------------------------------------
# R
# -----------------------------------------------------------------------------
# Basic usage:
#   library(unicefData)
#   df <- get_indicator("CME_MRY0T4")
#
# With filters:
#   df <- get_indicator("CME_MRY0T4",
#                       countries = c("BRA", "IND", "NGA"),
#                       year = "2015:2023")
#
# Wide format:
#   df <- get_indicator("CME_MRM0",
#                       year = "2015:2023",
#                       format = "wide")
#
# Raw (no disaggregation filtering):
#   df <- get_indicator("NT_CF_MAD", raw = TRUE)
#
# -----------------------------------------------------------------------------
# STATA
# -----------------------------------------------------------------------------
# Basic usage:
#   unicefdata, indicator(CME_MRY0T4) clear
#
# With filters:
#   unicefdata, indicator(CME_MRY0T4) countries(BRA IND NGA) year(2015:2023) clear
#
# Wide format:
#   unicefdata, indicator(CME_MRM0) year(2015:2023) wide clear
#
# Keep all columns (nosparse):
#   unicefdata, indicator(CME_MRY0T4) nosparse clear
#
# No disaggregation filtering (raw mode):
#   unicefdata, indicator(CME_MRY0T4) nofilter clear
#
# -----------------------------------------------------------------------------
# NOFILTER / RAW MODE
# -----------------------------------------------------------------------------
# By default, all platforms filter to totals (_T) for disaggregation dimensions.
# Use nofilter/raw mode to skip this and get ALL disaggregations:
#
#   Python:  get_indicator("CME_MRY0T4", raw=True)
#   R:       get_indicator("CME_MRY0T4", raw = TRUE)
#   Stata:   unicefdata, indicator(CME_MRY0T4) nofilter clear
#
# This is useful for:
#   - Accessing disaggregated data (sex=M/F, wealth quintiles, urban/rural)
#   - Verifying cross-platform consistency without filtering interference
#   - Debugging filtering differences between platforms
#
# -----------------------------------------------------------------------------
# KNOWN PLATFORM DIFFERENCES
# -----------------------------------------------------------------------------
# 1. Disaggregation filtering (default mode):
#    - All platforms: Filter to _T (totals) by default for dimensions in metadata
#    - Dimensions filtered: SEX, AGE, WEALTH_QUINTILE, RESIDENCE, MATERNAL_EDU_LVL
#
# 2. Raw/nofilter mode (raw=True / nofilter option):
#    - Python raw=True: Returns SDMX column names (REF_AREA, TIME_PERIOD, OBS_VALUE)
#    - R raw=TRUE: Partially renames columns (iso3, period, value) but keeps some SDMX
#    - Row counts may differ due to platform-specific raw mode implementation
#    - Column validation is skipped for nofilter tests due to these differences
#
# 3. Column schema (standard mode):
#    - Python: 21-57 columns (standard + extended metadata)
#    - R: 21 columns (standard, metadata="light")
#    - Stata: 14-19 columns (core set, may vary by dataflow)
#
# 4. Wide format columns:
#    - All platforms: period/value columns replaced by year columns
#    - Dimension columns may be aggregated or dropped
#
# =============================================================================

# =============================================================================
# Column Definitions (based on actual cached data analysis 2026-01-31)
# =============================================================================
#
# Column sets derived from analyzing cached data across platforms:
#   - Stata:  15 columns (minimal set)
#   - R:      21 columns (standard, metadata="light")
#   - Python: 23-57 columns (21 standard + extended metadata per dataflow)
#
# Data formats:
#   - long: One row per observation (default)
#   - wide: Years as columns, one row per country/indicator
#
# Column modes (for long format):
#   - common_core: 15 cols - intersection of ALL platforms (Stata minimum)
#   - standard:    21 cols - Python + R only (R's metadata="light")
#   - fullmeta:    All Python columns (schema regression testing)
#   - indicator:   Per-indicator required columns
# =============================================================================

# -----------------------------------------------------------------------------
# LONG FORMAT columns (default: one row per observation)
# -----------------------------------------------------------------------------

# COMMON_CORE columns - intersection of ALL 3 platforms (Stata's 15)
# These MUST be present in long format; missing any = test FAILURE
common_core:
  - iso3
  - country
  - period
  - indicator
  - value
  - sex
  - unit
  - obs_status
  - data_source
  - lower_bound
  - upper_bound
  - wealth_quintile
  - country_notes
  - geo_type
  - ref_period

# STANDARD columns - R's 21 columns (Python also has these)
# Use when testing Python + R only (Stata excluded)
standard_columns:
  - iso3
  - country
  - period
  - indicator
  - indicator_name
  - value
  - sex
  - age
  - unit
  - unit_name
  - obs_status
  - obs_status_name
  - data_source
  - lower_bound
  - upper_bound
  - wealth_quintile
  - residence
  - maternal_edu_lvl
  - country_notes
  - geo_type
  - ref_period

# EXTENDED columns - Python-only (always present beyond R's 21)
python_extended_columns:
  - sex_name
  - wealth_quintile_name

# -----------------------------------------------------------------------------
# WIDE FORMAT columns (years as columns, one row per country/indicator)
# -----------------------------------------------------------------------------

# COMMON_CORE for wide format - note: no 'period' or 'value' columns
# Year columns (2000, 2001, ..., 2025) contain the values instead
common_core_wide:
  - iso3
  - country
  - indicator
  - sex
  - unit
  - obs_status
  - data_source
  - wealth_quintile
  # Year columns are dynamic: 2000, 2001, ..., 2025

# STANDARD columns for wide format
standard_columns_wide:
  - iso3
  - country
  - indicator
  - indicator_name
  - sex
  - age
  - unit
  - unit_name
  - obs_status
  - obs_status_name
  - data_source
  - wealth_quintile
  - residence
  - maternal_edu_lvl
  # Year columns are dynamic: 2000, 2001, ..., 2025

# -----------------------------------------------------------------------------
# DATAFLOW-SPECIFIC columns - Python-only, varies by dataflow
# -----------------------------------------------------------------------------
dataflow_specific_columns:
  CME: []
  NUTRITION: []
  IMMUNISATION: []
  DM: [freq_coll, coverage_time]
  ECD: [ecd_domain, ec_educ_attnd, playthng_type, father_education, mother_education]
  COD: [cause_group, rank]
  PT: [admin_level, disability_status]
  ECON: [custodian, wgtd_sampl_size]
  FD: [education_level, ethnic_group, disability_status]

# Golden indicator set - 30 verified indicators across key dataflows
# Includes 5 nofilter tests to verify raw/nofilter mode consistency
golden_indicators:

  # =============================================================================
  # Child Mortality Estimates (CME)
  # =============================================================================
  # CME indicators have complete global coverage - can use full dataset or subset
  CME_MRY0T4:
    name: "Under-five mortality rate"
    dataflow: CME
    description: "Probability of dying between birth and exactly 5 years of age"
    expected_rows_min: 5000
    priority: critical
    expected_columns:
      required: [iso3, country, period, indicator, value, sex]
      optional: [lower_bound, upper_bound, obs_status]
    # Query filters for this indicator (null = use global defaults)
    # For CME, we have good global coverage, so fetch all data
    query_filters: null  # Uses global defaults (all countries, all years)

  CME_MRM0:
    name: "Neonatal mortality rate"
    dataflow: CME
    description: "Probability of dying during the first 28 days of life"
    expected_rows_min: 200
    priority: critical
    expected_columns:
      # Wide format: period becomes year columns, dimension columns may be aggregated
      required: [iso3, country]
      optional: [indicator, sex, lower_bound, upper_bound, obs_status]
    # Test wide format output
    query_filters:
      years: {start: 2015, end: 2023}
      countries: null
      data_format: wide

  # =============================================================================
  # Nutrition (NT)
  # =============================================================================
  # Nutrition indicators: survey-based, less frequent updates, good for subset testing
  NT_ANT_HAZ_NE2:
    name: "Stunting prevalence (moderate and severe)"
    dataflow: NUTRITION
    description: "Percentage of children under 5 with height-for-age < -2 SD"
    expected_rows_min: 1000
    priority: critical
    expected_columns:
      required: [iso3, country, period, indicator, value, sex, age]
      optional: [wealth_quintile, residence, maternal_edu_lvl, data_source]
    # Nutrition data is survey-based - use recent years for stability
    query_filters:
      years: {start: 2015, end: 2023}
      countries: null  # All countries
      data_format: long

  NT_ANT_WHZ_NE2:
    name: "Wasting prevalence (moderate and severe)"
    dataflow: NUTRITION
    description: "Percentage of children under 5 with weight-for-height < -2 SD"
    expected_rows_min: 500
    priority: high
    expected_columns:
      required: [iso3, country, period, indicator, value, sex, age]
      optional: [wealth_quintile, residence, data_source]
    query_filters:
      years: {start: 2015, end: 2023}
      countries: null
      data_format: long

  # NOTE: NT_BF_EXBF removed from golden set
  # Issue: Metadata doesn't include AGE in disaggregations_with_totals
  # Stata returns age=M0T5 (804 rows), Python/R filter to age=_T (128 rows)
  # This requires a metadata update to fix properly

  # =============================================================================
  # Immunization (IM)
  # =============================================================================
  IM_DTP3:
    name: "DTP3 immunization coverage"
    dataflow: IMMUNISATION
    description: "Percentage of infants who received third dose of DTP vaccine"
    expected_rows_min: 1000
    priority: critical
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [data_source, obs_status]
      indicator_specific: [vaccine]
    # Test year range filter
    query_filters:
      years: {start: 2010, end: 2023}
      countries: null
      data_format: long

  IM_MCV1:
    name: "Measles first dose coverage"
    dataflow: IMMUNISATION
    description: "Percentage of children who received first dose of measles vaccine"
    expected_rows_min: 200
    priority: high
    expected_columns:
      # Wide format: period becomes year columns, value data in year columns
      required: [iso3, country]
      optional: [indicator, data_source]
      indicator_specific: [vaccine]
    # Test wide format
    query_filters:
      years: {start: 2015, end: 2023}
      countries: null
      data_format: wide

  IM_RCV1:
    name: "Rubella vaccine coverage"
    dataflow: IMMUNISATION
    description: "Percentage of children who received rubella-containing vaccine"
    expected_rows_min: 2000
    priority: medium
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [data_source]
      indicator_specific: [vaccine]

  # =============================================================================
  # Education (ED)
  # =============================================================================
  ED_CR_L1:
    name: "Primary completion rate"
    dataflow: EDUCATION
    description: "Gross intake ratio to the last grade of primary education"
    expected_rows_min: 50
    priority: high
    expected_columns:
      required: [iso3, country, period, indicator, value, sex]
      optional: [data_source, obs_status]
    # Test country filter (major regions)
    query_filters:
      years: null
      countries: [USA, GBR, BRA, IND, NGA, ZAF, CHN, JPN, DEU, FRA]
      data_format: long

  ED_ANAR_L02:
    name: "Out-of-school rate, primary"
    dataflow: EDUCATION
    description: "Percentage of children of primary school age who are not in school"
    expected_rows_min: 50
    priority: high
    expected_columns:
      required: [iso3, country, period, indicator, value, sex]
      optional: [data_source]
    # Test year filter
    query_filters:
      years: {start: 2015, end: 2023}
      countries: null
      data_format: long

  # =============================================================================
  # HIV/AIDS (HVA)
  # =============================================================================
  # NOTE: HVA_EPI_LHIV_0-14 removed - indicator deprecated/not found in SDMX API

  HVA_PMTCT_MTCT:
    name: "Mother-to-child HIV transmission rate"
    dataflow: HIV_AIDS
    description: "Rate of vertical transmission of HIV from mother to child"
    expected_rows_min: 200
    priority: high
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [lower_bound, upper_bound]
    # Test year filter
    query_filters:
      years: {start: 2010, end: 2023}
      countries: null
      data_format: long

  HVA_PED_ART_CVG:
    name: "Pediatric ART coverage"
    dataflow: HIV_AIDS
    description: "Percentage of children 0-14 living with HIV receiving antiretroviral therapy"
    expected_rows_min: 50
    priority: high
    expected_columns:
      # Wide format: period becomes year columns, value data in year columns
      required: [iso3, country]
      optional: [indicator, lower_bound, upper_bound, data_source]
    # Test wide format + year filter combination
    query_filters:
      years: {start: 2015, end: 2023}
      countries: null
      data_format: wide

  # =============================================================================
  # Water, Sanitation, Hygiene (WS)
  # =============================================================================
  WS_PPL_W-B:
    name: "Population using basic drinking water services"
    dataflow: WASH_HOUSEHOLDS
    description: "Percentage of population using at least basic drinking water"
    expected_rows_min: 100
    priority: high
    expected_columns:
      # Note: Stata doesn't return 'residence' column, moved to optional
      required: [iso3, country, period, indicator, value]
      optional: [residence, data_source]
      indicator_specific: [service_type]
    # Test country filter
    query_filters:
      years: null
      countries: [AFG, BGD, ETH, KEN, MMR, NGA, PAK, TZA, UGA, ZMB]
      data_format: long

  WS_PPL_S-B:
    name: "Population using basic sanitation services"
    dataflow: WASH_HOUSEHOLDS
    description: "Percentage of population using at least basic sanitation"
    expected_rows_min: 100
    priority: high
    expected_columns:
      # Wide format: period becomes year columns, dimension columns may be aggregated
      required: [iso3, country]
      optional: [indicator, residence, data_source]
      indicator_specific: [service_type]
    # Test wide format
    query_filters:
      years: {start: 2015, end: 2023}
      countries: null
      data_format: wide

  # =============================================================================
  # Additional Child Mortality (CME)
  # =============================================================================
  # NOTE: DM_POP_TOT and DM_BRTS removed - inconsistent regional aggregate handling
  # Replaced with CME_MRY0 (working indicator from same dataflow as CME_MRY0T4)
  CME_MRY0:
    name: "Infant mortality rate"
    dataflow: CME
    description: "Probability of dying between birth and exactly 1 year of age"
    expected_rows_min: 1000
    priority: critical
    expected_columns:
      required: [iso3, country, period, indicator, value, sex]
      optional: [wealth_quintile, lower_bound, upper_bound]
    # Test year filter
    query_filters:
      years: {start: 2000, end: 2023}
      countries: null
      data_format: long

  # =============================================================================
  # Additional Nutrition (NT)
  # =============================================================================
  # NOTE: NT_CF_MAD removed from golden set
  # Issue: Metadata doesn't include AGE in disaggregations_with_totals
  # Stata returns 309 rows, Python/R filter to age=_T (104 rows)
  # This requires a metadata update to fix properly

  # =============================================================================
  # Maternal/Newborn/Child Health (MNCH)
  # =============================================================================
  MNCH_ANC4:
    name: "Antenatal care coverage (4+ visits)"
    dataflow: MNCH
    description: "Percentage of women with 4 or more antenatal care visits"
    expected_rows_min: 500
    priority: high
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [wealth_quintile, residence, data_source]

  MNCH_SAB:
    name: "Skilled birth attendance"
    dataflow: MNCH
    description: "Percentage of deliveries attended by skilled health personnel"
    expected_rows_min: 50
    priority: high
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [wealth_quintile, residence, data_source]
    # Test year + country filter combination
    query_filters:
      years: {start: 2015, end: 2023}
      countries: [AFG, BGD, COD, ETH, IND, IDN, NGA, PAK]
      data_format: long

  # =============================================================================
  # Child Protection (PT)
  # =============================================================================
  PT_CHLD_5-17_LBR_ECON:
    name: "Child labour prevalence"
    dataflow: PT
    description: "Percentage of children 5-17 engaged in economic activity"
    expected_rows_min: 200
    priority: medium
    expected_columns:
      required: [iso3, country, period, indicator, value, sex]
      optional: [age, residence, data_source]

  PT_F_20-24_MRD_U18:
    name: "Child marriage (women married before 18)"
    dataflow: PT
    description: "Percentage of women 20-24 married before age 18"
    expected_rows_min: 300
    priority: high
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [wealth_quintile, residence, data_source]

  # =============================================================================
  # Gender (GN)
  # =============================================================================
  GN_FB_BNK_ACCSS:
    name: "Financial account ownership"
    dataflow: GENDER
    description: "Percentage of population 15+ with a financial account"
    expected_rows_min: 300
    priority: medium
    expected_columns:
      required: [iso3, country, period, indicator, value, sex]
      optional: [residence, data_source]

  # =============================================================================
  # Poverty (PV)
  # =============================================================================
  # NOTE: PV_CHLD_DPRV-MN removed - indicator deprecated/not found in SDMX API
  PV_CHLD_INCM-PL:
    name: "Child income poverty"
    dataflow: CHLD_PVTY
    description: "Percentage of children living below national income poverty line"
    expected_rows_min: 100
    priority: high
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [data_source]
    query_filters: null

  # =============================================================================
  # Social Protection (SPP)
  # =============================================================================
  # NOTE: SPP_CHLD_POV_PROF removed - inconsistent platform behavior
  SPP_CHLD_SOC_PROT:
    name: "Children covered by social protection"
    dataflow: SOC_PROTECTION
    description: "Proportion of children covered by social protection programs"
    expected_rows_min: 50
    priority: high
    expected_columns:
      # Wide format: period becomes year columns, value data in year columns
      required: [iso3, country]
      optional: [indicator, data_source]
    # Test wide format
    query_filters:
      years: null
      countries: null
      data_format: wide

  # =============================================================================
  # Early Childhood Development (ECD)
  # =============================================================================
  # NOTE: ECD indicators have limited data and age filtering complexity
  # NOTE: ECD_CHLD_36-59M_LMPSL removed - indicator deprecated/not found in SDMX API

  # =============================================================================
  # Economic (ECON)
  # =============================================================================
  ECON_GVT_EXP_PTGDP:
    name: "Government expenditure on education (% GDP)"
    dataflow: ECON
    description: "Total government expenditure on education as percentage of GDP"
    expected_rows_min: 200
    priority: medium
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [data_source]

  # =============================================================================
  # Child Protection (PT)
  # NOTE: SPP_CHLD_POV_PROF removed - inconsistent platform behavior
  # =============================================================================
  PT_CHLD_1-14_PS-PSY-V_CGVR:
    name: "Violent discipline"
    dataflow: PT
    description: "Percentage of children 1-14 years who experienced physical or psychological aggression by caregivers"
    expected_rows_min: 100
    priority: medium
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [sex, age, wealth_quintile, residence, data_source]

  # =============================================================================
  # Additional Indicators (to reach 30 total)
  # =============================================================================

  # Additional CME indicator
  CME_MRY5T9:
    name: "Mortality rate 5-9 years"
    dataflow: CME
    description: "Probability of dying between age 5 and age 9"
    expected_rows_min: 3000
    priority: medium
    expected_columns:
      required: [iso3, country, period, indicator, value, sex]
      optional: [lower_bound, upper_bound]
    query_filters: null

  # Additional Nutrition indicator
  NT_ANT_WHZ_PO2:
    name: "Severe wasting prevalence"
    dataflow: NUTRITION
    description: "Percentage of children under 5 with weight-for-height < -3 SD"
    expected_rows_min: 100
    priority: medium
    expected_columns:
      required: [iso3, country, period, indicator, value, sex, age]
      optional: [wealth_quintile, residence, data_source]
    query_filters:
      years: {start: 2015, end: 2023}
      countries: null
      data_format: long

  # Additional Immunization indicator
  IM_HEPB3:
    name: "Hepatitis B third dose coverage"
    dataflow: IMMUNISATION
    description: "Percentage of infants who received third dose of Hepatitis B vaccine"
    expected_rows_min: 2000
    priority: medium
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [data_source]
    query_filters: null

  # Additional Child Protection indicator
  PT_CHLD_Y0T4_REG:
    name: "Birth registration"
    dataflow: PT
    description: "Percentage of children under 5 whose births are registered"
    expected_rows_min: 100
    priority: high
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [sex, age, wealth_quintile, residence, data_source]
    query_filters: null

  # Additional MNCH indicator
  MNCH_CSEC:
    name: "Caesarean section rate"
    dataflow: MNCH
    description: "Percentage of births by caesarean section"
    expected_rows_min: 100
    priority: medium
    expected_columns:
      required: [iso3, country, period, indicator, value]
      optional: [wealth_quintile, residence, data_source]
    query_filters: null

  # =============================================================================
  # NOFILTER Tests (raw mode - no default disaggregation filtering)
  # =============================================================================
  # These tests verify that all platforms return data when disaggregation
  # filtering is disabled (raw=True / nofilter option).
  #
  # IMPORTANT: Raw mode has KNOWN platform differences:
  # - Python raw=True: Returns raw SDMX column names (REF_AREA, TIME_PERIOD, OBS_VALUE)
  # - R raw=TRUE: Partially renames columns (iso3, period, value) but keeps some SDMX names
  # - Row counts may differ due to platform-specific raw mode implementation
  #
  # These tests verify the nofilter flag is working (not filtered to _T totals).
  # Column validation is SKIPPED for nofilter tests due to known platform differences.

  NT_ANT_HAZ_NE2_nofilter:
    name: "Stunting prevalence (nofilter)"
    indicator_code: NT_ANT_HAZ_NE2
    dataflow: NUTRITION
    description: "Test raw mode - should return all disaggregations"
    expected_rows_min: 500
    priority: high
    expected_columns:
      # Empty required list - column validation skipped for nofilter tests
      # Column names differ between platforms in raw mode (SDMX vs processed)
      required: []
      optional: [iso3, country, period, indicator, value, sex, age, wealth_quintile, residence, REF_AREA, TIME_PERIOD, OBS_VALUE]
    query_filters:
      years: {start: 2018, end: 2023}
      countries: null
      data_format: long
      nofilter: true

  IM_DTP3_nofilter:
    name: "DTP3 coverage (nofilter)"
    indicator_code: IM_DTP3
    dataflow: IMMUNISATION
    description: "Test raw mode - should return all data without filtering"
    expected_rows_min: 1000
    priority: high
    expected_columns:
      # Empty required list - column validation skipped for nofilter tests
      required: []
      optional: [iso3, country, period, indicator, value, data_source, REF_AREA, TIME_PERIOD, OBS_VALUE]
    query_filters:
      years: {start: 2018, end: 2023}
      countries: null
      data_format: long
      nofilter: true

  PT_F_20-24_MRD_U18_nofilter:
    name: "Child marriage (nofilter)"
    indicator_code: PT_F_20-24_MRD_U18
    dataflow: PT
    description: "Test raw mode - should return all disaggregations"
    expected_rows_min: 100
    priority: high
    expected_columns:
      # Empty required list - column validation skipped for nofilter tests
      required: []
      optional: [iso3, country, period, indicator, value, wealth_quintile, residence, data_source, REF_AREA, TIME_PERIOD, OBS_VALUE]
    query_filters:
      years: null
      countries: null
      data_format: long
      nofilter: true

  MNCH_ANC4_nofilter:
    name: "Antenatal care 4+ visits (nofilter)"
    indicator_code: MNCH_ANC4
    dataflow: MNCH
    description: "Test raw mode - should return all disaggregations"
    expected_rows_min: 500
    priority: high
    expected_columns:
      # Empty required list - column validation skipped for nofilter tests
      required: []
      optional: [iso3, country, period, indicator, value, wealth_quintile, residence, data_source, REF_AREA, TIME_PERIOD, OBS_VALUE]
    query_filters:
      years: null
      countries: null
      data_format: long
      nofilter: true

# =============================================================================
# Test Configuration
# =============================================================================
test_config:
  default_timeout_seconds: 120

  # Platforms to test
  platforms:
    - python
    - r
    - stata

  # Acceptable status codes (tests pass if status in this list)
  acceptable_status:
    - success
    - cached

  # Row count tolerance (allow Â±5% difference between platforms)
  row_tolerance_percent: 5

  # Column validation mode:
  #   - common_core: Use common_core (15) - ALL platforms must have these
  #   - standard: Use standard_columns (21) - Python + R only
  #   - fullmeta: All Python columns - Python schema regression only
  #   - indicator: Use per-indicator expected_columns.required
  column_mode: indicator  # Default: use indicator-specific required columns

  # Data format mode:
  #   - long:  Standard long format (default) - one row per observation
  #   - wide:  Years as columns (pivot) - one row per country/indicator
  data_format: long

  # -----------------------------------------------------------------------------
  # Global Query Filter Defaults
  # -----------------------------------------------------------------------------
  # These defaults apply when no CLI args or per-indicator filters are set.
  # Per-indicator query_filters override these global defaults.
  #
  # IMPORTANT: null means "fetch all" (no filter applied)
  #
  # Query parameter mapping across platforms:
  #   Parameter    | Python                  | R                     | Stata
  #   -------------|-------------------------|----------------------|------------------------
  #   countries    | countries=["USA","GBR"] | countries=c("USA")   | countries(USA GBR)
  #   year         | year=(2015,2020)        | year="2015:2020"     | year(2015:2020)
  #   data_format  | format="wide"           | format="wide"        | wide
  #   sex          | sex="_T"                | sex="_T"             | sex(_T)
  #   totals       | totals=False            | totals=FALSE         | nosparse
  #
  # Default values (when filter is null/not specified):
  #   countries:   All countries (no filter)
  #   year:        All years (no filter)
  #   data_format: "long" (one row per observation)
  #   sex:         "_T" (total, default aggregation)
  #   totals:      False (exclude subtotals)
  # -----------------------------------------------------------------------------

  # Global filters - apply to all indicators unless overridden
  # null = no filter (fetch all)
  test_countries: null  # Options: null, or list like [USA, GBR, IND, BRA, NGA]
  test_years: null      # Options: null, or range like {start: 2015, end: 2020}

  # Stable test preset - predefined filter combinations for reproducible tests
  # When stable_preset is set, it overrides test_countries and test_years
  stable_preset: null   # Options: null, "minimal", "standard", "comprehensive"

# -----------------------------------------------------------------------------
# Stable Test Presets
# -----------------------------------------------------------------------------
# Predefined filter combinations for reproducible, deterministic testing
stable_presets:
  # Minimal: Fast smoke test (5 countries, 3 years)
  minimal:
    countries: [USA, GBR, IND, BRA, NGA]
    years: {start: 2018, end: 2020}
    description: "Fast smoke test with 5 diverse countries and 3 recent years"

  # Standard: Balanced coverage (10 countries, 6 years)
  standard:
    countries: [USA, GBR, IND, BRA, NGA, CHN, DEU, FRA, JPN, ZAF]
    years: {start: 2015, end: 2020}
    description: "Balanced test with 10 countries across all regions"

  # Comprehensive: Full regional coverage (20 countries, 10 years)
  comprehensive:
    countries:
      # Americas
      - USA
      - BRA
      - MEX
      - ARG
      # Europe
      - GBR
      - DEU
      - FRA
      - ITA
      # Africa
      - NGA
      - ZAF
      - ETH
      - EGY
      # Asia
      - CHN
      - IND
      - JPN
      - IDN
      - PAK
      # Oceania
      - AUS
      # Middle East
      - SAU
      - IRN
    years: {start: 2010, end: 2020}
    description: "Comprehensive test with 20 countries across all regions"
